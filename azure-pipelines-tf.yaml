trigger: none
pool: Elanthamilan
steps:
  - task: TerraformInstaller@1
    inputs:
      terraformVersion: "latest"
  - task: TerraformTaskV4@4
    inputs:
      provider: "azurerm"
      command: "init"
      workingDirectory: "$(System.DefaultWorkingDirectory)/core-infra-1"
      backendServiceArm: "Pay-As-You-Go(66a13570-6644-4894-bb1a-2fbea6c65d07)"
      backendAzureRmResourceGroupName: "tfstate"
      backendAzureRmStorageAccountName: "tfstateazureterraform"
      backendAzureRmContainerName: "tfstate"
      backendAzureRmKey: "terraform.tfstate"
  - task: TerraformTaskV4@4
    inputs:
      provider: "azurerm"
      command: "plan"
      workingDirectory: "$(System.DefaultWorkingDirectory)/core-infra-1"
      commandOptions: "-var-file ../ENV/core-infra-1.tfvars"
      environmentServiceNameAzureRM: "Pay-As-You-Go(66a13570-6644-4894-bb1a-2fbea6c65d07)"

  - task: TerraformTaskV4@4
    inputs:
      provider: "azurerm"
      command: "apply"
      workingDirectory: "$(System.DefaultWorkingDirectory)/core-infra-1"
      commandOptions: "-var-file ../ENV/core-infra-1.tfvars"
      environmentServiceNameAzureRM: "Pay-As-You-Go(66a13570-6644-4894-bb1a-2fbea6c65d07)"
